<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>게시판 목록</title>
    <link rel="stylesheet" href="/css/list.css">
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Jua&family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="/js/locationOk.js"></script>
</head>
<body>
<input id="locationInfo" type="hidden" th:value="${locationMissing}">

<!-- Header -->
<th:block th:replace="~{common/header :: header-fragment}"></th:block>

<!-- Type 선택 -->
<form method="get" action="/board/list">
    <select class="selectType" name="type" onchange="this.form.submit()">
        <option value="guest" th:selected="${selectedType == 'guest'}">손님</option>
        <option value="helper" th:selected="${selectedType == 'helper'}">도우미</option>
    </select>
</form>

<!-- 작성 버튼 -->
<input type="hidden" th:value="${id}" id="loginUserId">
<div id="button">
    <a class="writeBtn" th:href="@{/board/write}" onclick="return checkLogin()">게시물 작성하기</a>
</div>

<!-- 페이징 정보 -->
<div class="mb-3 mt-3 clearfix">
    <span class="float-start me-2" th:text="${'총 ' + cnt + '개'}"></span>
    <span class="float-start" th:text="${'page ' + page + '/' + totalPage}"></span>
    <span class="float-end">
        <form name="frmPageRows" method="post" action="/board/pageRows">
            <input type="hidden" name="page" th:value="${page}">
            <select class="form-select" name="pageRows" onchange="this.form.submit()">
                <option value="10" th:selected="${pageRows == 10}">10</option>
                <option value="15" th:selected="${pageRows == 15}">15</option>
                <option value="20" th:selected="${pageRows == 20}">20</option>
                <option value="50" th:selected="${pageRows == 50}">50</option>
            </select>
        </form>
    </span>
</div>

<!-- 게시글 카드 목록 -->
<div th:each="board: ${boardList}" class="board" th:attr="data-id=${board.id}"
     onclick="location.href='/board/detail/' + this.getAttribute('data-id')" style="cursor:pointer;">

  <!-- 이미지 -->
  <div class="image-wrapper">
      <img th:if="${board.fileList != null and board.fileList.size() > 0 and board.fileList[0].image}"
           th:src="@{'/upload/' + ${board.fileList[0].fileName}}"
           class="img-thumbnail"
           alt="image">
      <div th:if="${board.fileList == null or board.fileList.size() == 0 or !board.fileList[0].image}"
           class="no-image">이미지 없음</div>
  </div>

  <!-- 텍스트 -->
  <div class="text-area">
      <a class="title" th:text="${board.title}"></a>
      <div class="name-wrapper"><a class="name" th:text="${board.name}"></a></div>
      <a class="content" th:text="${board.content}"></a>
      <div th:unless="${id} == ${board.user_id}">
          <a class="follow" th:if="${board.type == 'helper'}"
             th:text="${board.follow} == true ? 'FOLLOWING' : 'NOPE'"></a>
      </div>
      <div class="tagType" th:if="${board.type == 'guest'}">
          <span class="tagName" th:each="tag : ${board.post_tag}" th:text="'#' + ${tag.name}"
                th:style="'color:' + ${tag.color} + '; border: 1px solid ' + ${tag.color}"></span>
      </div>
      <div class="tagType" th:if="${board.type == 'helper'}">
          <span class="tagName" th:each="tag : ${board.user_tag}" th:text="'#' + ${tag.name}"
                th:style="'color:' + ${tag.color} + '; border: 1px solid ' + ${tag.color}"></span>
      </div>
      <a class="followCount" th:if="${board.type == 'helper'}" th:text="'팔로워 : ' + ${board.followCount} "></a>
      <a class="day"
         th:text="${#temporals.format(board.createdat, board.createdat.monthValue >= 10 ? 'yy년 MM월 dd일 HH시' : 'yy년 M월 d일 H시')}"></a>
  </div>
</div>
<!-- 페이징 하단 -->
<th:block th:insert="~{board/pagination::pagination}"></th:block>

<div class="row">
    <div class="col-12">
        <a class="btn btn-outline-dark" th:href="@{/board/write}" sec:authorize="hasAnyRole('ADMIN', 'MEMBER')">작성</a>
    </div>
</div>

<script>
    function checkLogin() {
        const loginUserId = document.getElementById('loginUserId').value;
        if (!loginUserId) {
            alert("로그인 하셔야 합니다");
            location.href = "/user/login";
            return false;
        }
        return true;
    }
</script>

</body>
</html>
