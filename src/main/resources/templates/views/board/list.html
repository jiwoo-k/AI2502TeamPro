<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>게시물 목록</title>
    <th:block th:replace="~{common/header :: headline-fragment}"></th:block>
    <link rel="stylesheet" th:href="@{/css/list.css}">
</head>

<div>
    <br>
<!--    &lt;!&ndash; Bootstrap CSS: 필수 &ndash;&gt;-->
<!--    &lt;!&ndash; Bootstrap CSS (SRI 제거) &ndash;&gt;-->
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>-->
<!--    <link rel="stylesheet" th:href="@{/css/style.css}">-->

<!--    &lt;!&ndash; 이 4개는 헤더를 사용하는 모든 페이지에 포함되어야합니다. &ndash;&gt;-->
<!--    &lt;!&ndash; 올바른 순서대로 해야 충돌 없이 작동한답니다... &ndash;&gt;-->
<!--    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>-->
<!--&lt;!&ndash;    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY"></script>&ndash;&gt;-->
<!--    <script th:src="@{/js/location.js}"></script>-->
    <script th:src="@{/js/locationOk.js}"></script>
<!--    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>&lt;!&ndash; Bootstrap CSS: 필수 &ndash;&gt;-->

<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1">-->
<!--    <title>게시물 목록</title>-->
<!--    <link rel="stylesheet" href="/css/list.css">-->
<!--    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Jua&family=Noto+Sans+KR:wght@100..900&display=swap"-->
<!--          rel="stylesheet">-->
<!--    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>-->
<!--    <script src="/js/locationOk.js"></script>-->

<!--    &lt;!&ndash; Bootstrap & Header Head&ndash;&gt;-->
<!--    &lt;!&ndash; Bootstrap CSS: 필수 &ndash;&gt;-->
<!--    <link-->
<!--            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"-->
<!--            rel="stylesheet"-->
<!--    />-->
<!--    <link rel="stylesheet" th:href="@{/css/style.css}">-->
<!--    <link rel="stylesheet" th:href="@{/css/header.css}">-->

<!--    &lt;!&ndash; 이 4개는 헤더를 사용하는 모든 페이지에 포함되어야합니다. &ndash;&gt;-->
<!--    &lt;!&ndash; 올바른 순서대로 해야 충돌 없이 작동한답니다... &ndash;&gt;-->
<!--    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>-->
<!--    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY"></script>-->
<!--    <script th:src="@{/js/location.js}"></script>-->
<!--    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>-->
<!--    &lt;!&ndash; Bootstrap & Header Head&ndash;&gt;-->
<!--</head>-->
</div>

<body>
<input id="locationInfo" type="hidden" th:value="${locationMissing}">
<!--header-->
<th:block th:replace="~{common/header :: header-fragment}"></th:block>

<!-- 정렬을 위한 wrapper -->
<div class="list-header d-flex justify-content-between align-items-center flex-wrap px-3 py-2 mb-3">

    <!-- 좌측: type + pageRows -->
    <form method="get" action="/board/list" id="listControlForm" class="d-flex gap-2 align-items-center">
        <select class="form-select w-auto" name="type" onchange="submitListForm()">
            <option value="guest" th:selected="${selectedType == 'guest'}">손님</option>
            <option value="helper" th:selected="${selectedType == 'helper'}">도우미</option>
        </select>


        <select class="form-select w-auto" name="pageRows" onchange="submitListForm()">
            <option value="10" th:selected="${pageRows == 10}">10개씩 보기</option>
            <option value="15" th:selected="${pageRows == 15}">15개씩 보기</option>
            <option value="20" th:selected="${pageRows == 20}">20개씩 보기</option>
            <option value="50" th:selected="${pageRows == 50}">50개씩 보기</option>
        </select>


        <!-- 유지해야 할 페이지 번호 (현재 페이지 유지) -->
        <input type="hidden" name="page" th:value="${page}"/>
    </form>
    <script>
        function submitListForm() {
            document.getElementById('listControlForm').submit();
        }
    </script>

    <!-- 중앙 정렬된 페이징 텍스트 -->
    <div class="text-center flex-grow-1">
        <span th:text="'총 ' + ${cnt} + '개'"></span>&nbsp;
        <span th:text="'page ' + ${page} + '/' + ${totalPage}"></span>
    </div>

    <!-- 우측: 작성 버튼 -->
    <div id="button">
        <a class="btn btn-success writeBtn" th:href="@{/board/write}" onclick="return checkLogin()">게시물 작성하기</a>
    </div>
</div>

<!-- 카드형 게시글 목록 -->
<div th:each="board : ${boardList}" class="board" th:attr="data-id=${board.id}"
     onclick="location.href='/board/detail/' + this.getAttribute('data-id')" style="cursor:pointer;">

    <div id="attachment">
        <div class="container mt-3 mb-3 border rounded">
            <div class="image-wrapper">
                <img th:if="${not #lists.isEmpty(board.fileList) and board.fileList[0].image == true}"
                     th:src="@{'/upload/' + ${board.fileList[0].fileName}}"
                     class="img-thumbnail" alt="image">
                <div th:if="${#lists.isEmpty(board.fileList) or !board.fileList[0].image}"
                     class="image-thumbnail" style="background-color: #888; color: white;">
                    <span>이미지 없음</span>
                </div>
            </div>
        </div>
    </div>

    <div id="text-area">
        <a class="title" th:text="${board.title}"></a>
        <div class="name-wrapper">
            <a class="name" th:text="${board.name}"></a>
        </div>
        <a class="content" th:text="${board.content}"></a>

        <div th:unless="${id} == ${board.user_id}">
            <a class="follow" th:if="${board.type == 'helper'}"
               th:text="${board.follow} == true ? 'FOLLOWING' : 'NOPE'"></a>
        </div>

        <div class="tagType" th:if="${board.type == 'guest'}">
            <span class="tagName" th:each="tag : ${board.post_tag}" th:text="'#' + ${tag.name}"
                  th:style="'color:' + ${tag.color} + '; border: 1px solid ' + ${tag.color}"></span>
        </div>
        <div class="tagType" th:if="${board.type == 'helper'}">
            <span class="tagName" th:each="tag : ${board.user_tag}" th:text="'#' + ${tag.name}"
                  th:style="'color:' + ${tag.color} + '; border: 1px solid ' + ${tag.color}"></span>
        </div>

        <a class="followCount" th:if="${board.type == 'helper'}" th:text="'팔로워 : ' + ${board.followCount}"></a>
        <a class="day"
           th:text="${#temporals.format(board.createdat, board.createdat.monthValue >= 10 ? 'yy년 MM월 dd일 HH시' : 'yy년 M월 d일 H시')}"></a>
    </div>
</div>

<!-- pagination -->
<th:block th:insert="~{board/pagination::pagination}"></th:block>

<script>
    function checkLogin() {
        const loginUserId = document.getElementById('loginUserId').value;
        if (!loginUserId) {
            alert("로그인 하셔야 합니다");
            location.href = "/user/login";
            return false;
        }
        return true;
    }
</script>
</body>
</html>
